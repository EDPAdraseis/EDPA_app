<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Εθελοντική Δράση Πάρνηθας</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDWMfUcLVhD0BqVstQ9aSuAv3BIKfy0-jI",
  authDomain: "edpa-a3b38.firebaseapp.com",
  projectId: "edpa-a3b38",
  storageBucket: "edpa-a3b38.firebasestorage.app",
  messagingSenderId: "242306230950",
  appId: "1:242306230950:web:4539b9eefe19f0e4b0a267"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.fb = {
  auth,
  db,
  signInAnonymously,
  onAuthStateChanged,
  collection,
  addDoc,
  doc,
  deleteDoc,
  onSnapshot
};
</script>

<style>
body { font-family: Inter, system-ui, sans-serif; }
</style>
</head>

<body class="bg-slate-100">

<div id="root"></div>

<script type="text/babel">

const { useState, useEffect } = React;

const APP_ID = "edpa-app";

/* -------------------- APP -------------------- */

function App(){

  const [user,setUser] = useState(null);
  const [news,setNews] = useState([]);
  const [actions,setActions] = useState([]);
  const [admin,setAdmin] = useState(false);
  const [pass,setPass] = useState("");

  const [newsForm,setNewsForm] = useState({title:"",summary:""});
  const [actForm,setActForm] = useState({title:"",date:"",location:""});

  const [msg,setMsg] = useState("");

  /* ---------- AUTH ---------- */

  useEffect(()=>{

    if(!window.fb) return;

    fb.signInAnonymously(fb.auth);

    const unsub = fb.onAuthStateChanged(fb.auth,u=>{
      if(u) setUser(u);
    });

    return ()=>unsub();

  },[]);


  /* ---------- DATA ---------- */

  useEffect(()=>{

    if(!user) return;

    const base = ["artifacts",APP_ID,"public","data"];

    const newsRef = fb.collection(fb.db,...base,"news");
    const actRef  = fb.collection(fb.db,...base,"actions");

    const u1 = fb.onSnapshot(newsRef,snap=>{
      setNews(snap.docs.map(d=>({id:d.id,...d.data()})));
    });

    const u2 = fb.onSnapshot(actRef,snap=>{
      setActions(snap.docs.map(d=>({id:d.id,...d.data()})));
    });

    return ()=>{u1();u2();};

  },[user]);


  /* ---------- HELPERS ---------- */

  const toast = t=>{
    setMsg(t);
    setTimeout(()=>setMsg(""),3000);
  };

  const add = async(col,data)=>{

    if(!user) return;

    const ref = fb.collection(
      fb.db,
      "artifacts",APP_ID,"public","data",col
    );

    await fb.addDoc(ref,data);

    toast("Αποθηκεύτηκε ✔");
  };


  const del = async(col,id)=>{

    const ref = fb.doc(
      fb.db,
      "artifacts",APP_ID,"public","data",col,id
    );

    await fb.deleteDoc(ref);

    toast("Διαγράφηκε ✔");
  };


/* -------------------- UI -------------------- */

return(

<div className="max-w-lg mx-auto p-4">

{/* STATUS */}
{msg &&
<div className="fixed top-4 left-1/2 -translate-x-1/2 bg-emerald-600 text-white px-4 py-2 rounded">
  {msg}
</div>
}

<h1 className="text-2xl font-bold mb-4 text-center">
Εθελοντική Δράση Πάρνηθας
</h1>


{/* LOGIN */}
{!user &&
<div className="text-center py-20">
  Σύνδεση...
</div>
}


{/* CONTENT */}
{user &&

<div className="space-y-8">


{/* ADMIN */}
<div className="bg-white p-4 rounded shadow">

<h2 className="font-bold mb-2">Admin</h2>

{!admin ?

<div className="flex gap-2">

<input
 type="password"
 className="border p-2 flex-1"
 placeholder="Κωδικός"
 value={pass}
 onChange={e=>setPass(e.target.value)}
/>

<button
 className="bg-emerald-600 text-white px-4"
 onClick={()=>pass==="1234"?setAdmin(true):toast("Λάθος")}
>
Login
</button>

</div>

:

<div className="space-y-4">


{/* ADD ACTION */}
<div>

<h3 className="font-semibold">Νέα Δράση</h3>

<input className="border p-2 w-full mb-1"
 placeholder="Τίτλος"
 value={actForm.title}
 onChange={e=>setActForm({...actForm,title:e.target.value})}
/>

<input className="border p-2 w-full mb-1"
 placeholder="Ημερομηνία"
 value={actForm.date}
 onChange={e=>setActForm({...actForm,date:e.target.value})}
/>

<input className="border p-2 w-full mb-2"
 placeholder="Τοποθεσία"
 value={actForm.location}
 onChange={e=>setActForm({...actForm,location:e.target.value})}
/>

<button
 className="bg-emerald-600 text-white px-3 py-1"
 onClick={()=>add("actions",{
   ...actForm,
   type:"Δράση"
 })}
>
Προσθήκη
</button>

</div>


{/* ADD NEWS */}
<div>

<h3 className="font-semibold">Νέα Ανακοίνωση</h3>

<input className="border p-2 w-full mb-1"
 placeholder="Τίτλος"
 value={newsForm.title}
 onChange={e=>setNewsForm({...newsForm,title:e.target.value})}
/>

<textarea className="border p-2 w-full mb-2"
 placeholder="Περιγραφή"
 value={newsForm.summary}
 onChange={e=>setNewsForm({...newsForm,summary:e.target.value})}
/>

<button
 className="bg-emerald-600 text-white px-3 py-1"
 onClick={()=>add("news",{
   ...newsForm,
   date:new Date().toLocaleDateString()
 })}
>
Προσθήκη
</button>

</div>


<button
 className="text-sm text-gray-500 underline"
 onClick={()=>setAdmin(false)}
>
Έξοδος
</button>

</div>

}

</div>


{/* NEWS */}
<div>

<h2 className="font-bold mb-2">Νέα</h2>

{news.map(n=>

<div key={n.id} className="bg-white p-3 rounded shadow mb-2">

{admin &&
<button
 className="text-red-500 text-sm float-right"
 onClick={()=>del("news",n.id)}
>
X
</button>
}

<div className="text-xs text-gray-500">{n.date}</div>

<div className="font-semibold">{n.title}</div>

<div className="text-sm">{n.summary}</div>

</div>

)}

</div>


{/* ACTIONS */}
<div>

<h2 className="font-bold mb-2">Δράσεις</h2>

{actions.map(a=>

<div key={a.id} className="bg-white p-3 rounded shadow mb-2">

{admin &&
<button
 className="text-red-500 text-sm float-right"
 onClick={()=>del("actions",a.id)}
>
X
</button>
}

<div className="text-xs text-gray-500">{a.date}</div>

<div className="font-semibold">{a.title}</div>

<div className="text-sm">{a.location}</div>

</div>

)}

</div>

</div>

}

</div>

);

}

/* -------------------- RENDER -------------------- */

ReactDOM
.createRoot(document.getElementById("root"))
.render(<App/>);

</script>

</body>
</html>
